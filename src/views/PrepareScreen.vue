<template>
    <ion-page>
      <ion-content :fullscreen="true">
        <flow-form
          ref="flowform"
          v-on:complete="onComplete"
          v-bind:language="language"
          v-bind:progressbar="false"
          v-bind:standalone="true"
        >
          <question 
            v-for="(question, index) in questions" 
            v-bind="question" 
            v-bind:key="'m' + index" 
            v-model="question.model"
          >
          </question>
          
          <!-- Custom content for the Complete/Submit screen slots in the FlowForm component -->
          <template v-slot:complete>
            <div class="f-section-wrap">
              <div v-if="questions[0].model === 'technical_issue'">
                <span class="f-tagline">Submit issue &gt; Step 3/3</span>
                <div v-if="loading">
                  <span class="fh2">Please wait, submitting...</span>
                </div>
                <div v-else>
                  <span class="fh2">Your ticket number is: {{ getTicket() }}</span>
                  <p class="f-description"><span>Thank You üòä. Our support team will contact you as soon as possible.</span></p>
                </div>
              </div>
              <div v-else>
                <span class="f-tagline">Support page &gt; Ticket status</span>
                <div v-if="loading">
                  <span class="fh2">Please wait, checking...</span>
                </div>
                <div v-else>
                  <span  class="fh2">Good news - the wheels are turning, your ticket No. {{ formatTicket(questions[2].model) }} is being processed!üòâ</span>
                  <p class="f-description"><span>Have a great day!</span></p>
                </div>
              </div>
            </div>  
          </template>
          <!-- We've overriden the default "complete" slot content -->
          <template v-slot:completeButton>
            <div class="f-submit">
              <!-- Leave empty to hide default submit button -->
            </div>
          </template>
        </flow-form>
      </ion-content>
    </ion-page>
  </template>

<style scoped>
  rion-content{
    background: linear-gradient(to bottom, rgba(0, 0, 0, 0.121) 10%, rgba(2, 156, 12, 0.714)), url('https://images.unsplash.com/photo-1586078074298-05dca4848695?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1935&q=80') !important;
    background-position: 100%;
    background-size: cover !important;
  }

  .vff ul.f-radios li {
    border-radius: 20px !important;
  }
</style>
  
  <script lang="ts">
  import { defineComponent } from 'vue';
  import { IonPage, IonContent } from '@ionic/vue';
  import { FlowForm, Question, QuestionModel, QuestionType, ChoiceOption, LanguageModel } from '@ditdot-dev/vue-flow-form'
  
  export default  defineComponent({
    name: 'Tab1Page',
    components: { IonContent, IonPage, FlowForm, Question },
    data() {
      return {
        loading: false,
        completed: false,
        language: new LanguageModel(),
        questions: [
          {
            type: 'multiplechoice',
            id: 'any_meditations_experience',
            tagline: '–î–∞–≤–∞–π—Ç–µ —É–∑–Ω–∞–µ–º –≤–∞—Å –ª—É—á—à–µ!',
            title: 'üëã, –ø—Ä–æ–±–æ–≤–∞–ª–∏ –ª–∏ –≤—ã –º–µ–¥–∏—Ç–∞—Ü–∏–∏ —Ä–∞–Ω–µ–µ?',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–†–∞–Ω–µ–µ —è –Ω–µ –ø—Ä–æ–±–æ–≤–∞–ª –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –≤–æ–≤—Å–µ',
                value: 'technical_issue'
              },
              {
                label: '–Ø –ø—Ä–æ–±–æ–≤–∞–ª, –Ω–æ —É –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∞–ª–æ—Å—å, –ª–∏–±–æ –º–Ω–µ –±—ã–ª–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ',
                value: 'enter_ticket'
              },
              {
                label: '–£ –º–µ–Ω—è –µ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –æ–ø—ã—Ç –≤ —ç—Ç–æ–º –¥–µ–ª–µ',
                value: 'enter_ticket'
              },
              {
                label: '–Ø –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª –≤ —ç—Ç–æ–º!',
                value: 'enter_ticket'
              },
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_canworkwithcloserelations',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø —É–º–µ—é —Ä–∞–∑–≤–∏–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–µ—Å–Ω—ã–µ –≤–∑–∞–∏–º–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_cantakeresponsibility',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø –ø—Ä–∏–Ω–∏–º–∞—é –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_cantakeobstacklesasopportunities',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω—ã –∫–∞–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–æ—Å—Ç–∞.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_cantakecontroloverlife',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é —Å–≤–æ—é –∂–∏–∑–Ω—å.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_canlaughtonmylifeandme',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø —É–º–µ—é —Å–º–µ—è—Ç—å—Å—è –Ω–∞–¥ –∂–∏–∑–Ω—å—é –∏ –Ω–∞–¥ —Å–æ–±–æ–π.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_feelgood',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Ö–æ—Ä–æ—à–æ.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_canworkwithstressandtakerest',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–£ –º–µ–Ω—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∞–¥–µ–∫–≤–∞—Ç–Ω–æ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–¥—ã—Ö–∞.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_canlearnbymymistrakes',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø —Å–ø–æ—Å–æ–±–µ–Ω –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å —Å–≤–æ–∏ –ª–∏—á–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –∏ —É—á–∏—Ç—å—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –æ—à–∏–±–∫–∞—Ö.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_canexpressfeelings',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø —É–º–µ—é —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∏ –≤—ã—Ä–∞–∂–∞—Ç—å —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'psycho_emotional_enjoylife',
            tagline: '–£–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–æ –¥–ª—è –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
            title: '–Ø –Ω–∞—Å–ª–∞–∂–¥–∞—é—Å—å –∂–∏–∑–Ω—å—é.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'date',
            id: 'birtdate',
            tagline: '–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å ',
            title: '–Ø –Ω–∞—Å–ª–∞–∂–¥–∞—é—Å—å –∂–∏–∑–Ω—å—é.',
            multiple: false,
            required: true,
            helpTextShow: false,
            options: [
              {
                label: '–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞',
                value: 'almost_always'
              },
              {
                label: '–ò–Ω–æ–≥–¥–∞/–∏–∑—Ä–µ–¥–∫–∞',
                value: 'sometimes'
              },
              {
                label: '–û—á–µ–Ω—å —Ä–µ–¥–∫–æ',
                value: 'very_seldom'
              }
            ],
            model: '',
          },
          {
            type: 'multiplechoice',
            id: 'technical_issue',
            tagline: 'Submit issue > Step 1/3',
            title: 'Have you read our technical FAQ?',
            multiple: false,
            required: true,
            helpTextShow: false,
            description: "Here you'll find answers to",
            descriptionLink: [
              {
                url: '#',
                text: 'FAQs',
                target: '_self'
              }
            ],
            options: [          
              {
                label: 'Yes, but I couldn‚Äôt find the answer',
                value: 'faq_no'
              }
            ],
            jump: {
              faq_no: 'faq_no'
            },
            model: '',
          },
          {
            type: 'text',
            id: 'enter_ticket',
            tagline: 'Support page > Ticket status',
            title: 'Please enter your 6-digit code.',
            subtitle: 'You received this when you reported your problem.',
            multiple: false, 
            required: true,
            mask: '#-#-#-#-#-#',
            placeholder: '#-#-#-#-#-#',
            jump: {
              _other: '_submit'
            },
            model: ''
          },
          {
            type: 'longtext',
            id: "faq_no",
            tagline: 'Submit issue > Step 2/3',
            title: 'Please describe your problem.',
            required: true,
            placeholder: 'Start typing here...',
            model: ''
          },
          {
            type: 'iconrate',
            id: 'icon_rate',
            tagline: "One more thing before you go",
            title: 'How would you rate our service?',
            required: false,
            max: 5,
            model: ''
          },
        ]
      }
    },
    methods: {
      /* eslint-disable-next-line no-unused-vars */
      onComplete(completed, questionList) {
        // This method is called whenever the "completed" status is changed.
        this.completed = completed
        // Set `submitted` to true so the form knows not to allow back/forward
        // navigation anymore.
        //!!! this.$refs.flowform.submitted = true
        this.onSendData()
      },
      
      onSendData() {
        // eslint-disable-next-line
        const self = this
        const data = this.getData()
        this.loading = true
        
        /*
          You can use Fetch API to send the data to your server, eg.:
          fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          })
        */
        setTimeout(() => {
          self.loading = false
        }, 1500)
      },
      getData() {
        var data = {
          questions: [],
          answers: []
        }
    
        this.questions.forEach(question => {
          if (question.title) {
            let answer = question.model
            if (Array.isArray(answer)) {
              answer = answer.join(', ')
            }
            // eslint-disable-next-line
            data.questions.push(question.title)
            // eslint-disable-next-line
            data.answers.push(answer)
          }
        })
    
        return data
      },
      formatTicket(ticket) {
        return ticket && ticket.replace(/-/g, '')
      },
      getTicket() {
        return Math.floor(Math.random() * (999999 - 100000) + 100000).toString()
      }
    }
  });
  </script>

<style>
/* Import Vue Flow Form base CSS */
@import '~@ditdot-dev/vue-flow-form/dist/vue-flow-form.css';
/* Import one of the Vue Flow Form CSS themes (optional) */
/* @import '~@ditdot-dev/vue-flow-form/dist/vue-flow-form.theme-minimal.css'; */
/* @import '~@ditdot-dev/vue-flow-form/dist/vue-flow-form.theme-green.css'; */
@import '../assets/css/quiz-flow.css';
</style>
  